#!/bin/bash

if [ "$1" = "focus-next" ]; then
	FOCUSED_WINDOW_ID="$(xdotool getwindowfocus)"
	WINDOW_ID="$(xdotool search --onlyvisible --maxdepth 1 --role "" | sort -n | tail -n +2 | awk "/${FOCUSED_WINDOW_ID}/{found=1; next} found" | head -n 1)"
	if [ "${WINDOW_ID}" = "" ]; then
		WINDOW_ID="$(xdotool search --onlyvisible --maxdepth 1 --role "" | sort -n | tail -n +2 | head -n 1)"
		if [ "${WINDOW_ID}" = "" ]; then
			exit 1
		fi
	fi

	read WIDTH HEIGHT <<<$(xrandr | grep '*' | awk '{print $1}' | head -n 1 | awk -Fx '{print $1, $2}')
	xdotool windowfocus ${WINDOW_ID}
	xdotool windowraise ${WINDOW_ID}
	xdotool windowmove ${WINDOW_ID} 0 0
	xdotool windowsize ${WINDOW_ID} ${WIDTH} ${HEIGHT}
elif [ "$1" = "focus-prev" ]; then
	FOCUSED_WINDOW_ID="$(xdotool getwindowfocus)"
	WINDOW_ID="$(xdotool search --onlyvisible --maxdepth 1 --role "" | sort -n | tail -n +2 | tac | awk "/${FOCUSED_WINDOW_ID}/{found=1; next} found" | head -n 1)"
	if [ "${WINDOW_ID}" = "" ]; then
		WINDOW_ID="$(xdotool search --onlyvisible --maxdepth 1 --role "" | sort -n | tail -n +2 | tac | head -n 1)"
		if [ "${WINDOW_ID}" = "" ]; then
			exit 1
		fi
	fi

	read WIDTH HEIGHT <<<$(xrandr | grep '*' | awk '{print $1}' | head -n 1 | awk -Fx '{print $1, $2}')
	xdotool windowfocus ${WINDOW_ID}
	xdotool windowraise ${WINDOW_ID}
	xdotool windowmove ${WINDOW_ID} 0 0
	xdotool windowsize ${WINDOW_ID} ${WIDTH} ${HEIGHT}
elif [ "$1" = "choose-focus" ]; then
	WINDOW_ID="$(xdotool search --onlyvisible --maxdepth 1 --role "" | sort -n | tail -n +2 | dmenu)"

	read WIDTH HEIGHT <<<$(xrandr | grep '*' | awk '{print $1}' | head -n 1 | awk -Fx '{print $1, $2}')
	xdotool windowfocus ${WINDOW_ID}
	xdotool windowraise ${WINDOW_ID}
	xdotool windowmove ${WINDOW_ID} 0 0
	xdotool windowsize ${WINDOW_ID} ${WIDTH} ${HEIGHT}
elif [ "$1" = "close-focused" ]; then
	WINDOW_ID="$(xdotool getwindowfocus)"
	xdotool windowclose ${WINDOW_ID}
	if [ $? -ne 0 ]; then
		xdotoop windowkill ${WINDOW_ID}
	fi
elif [ "$1" = "fake-fullscreen" ]; then
	WINDOW_ID="$(xdotool getwindowfocus)"
	read WIDTH HEIGHT <<<$(xrandr | grep '*' | awk '{print $1}' | head -n 1 | awk -Fx '{print $1, $2}')
	xdotool windowmove ${WINDOW_ID} 0 0
	xdotool windowsize ${WINDOW_ID} ${WIDTH} ${HEIGHT}
# elif [ "$1" = "run-application" ]; then
# 	WINDOW_ID="$(xdotool getwindowfocus)"
# 	read WIDTH HEIGHT <<<$(xrandr | grep '*' | awk '{print $1}' | head -n 1 | awk -Fx '{print $1, $2}')
# 	xdotool windowmove ${WINDOW_ID} 0 0
# 	xdotool windowsize ${WINDOW_ID} ${WIDTH} ${HEIGHT}
else
	echo "Wrong command"
fi
